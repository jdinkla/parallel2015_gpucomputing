/*
* Copyright (c) 2015 by Joern Dinkla, www.dinkla.com, All rights reserved.
*
* See the LICENSE file in the root directory.
*/

#include "HeatUtilities.h"
#include <random>
#include <functional>
#include "PinnedBuffer.h"
#include <assert.h>

using namespace std;

const int margin = 40;
const float min_temp = 0.0f;
const float max_temp = 100.0f;

//void do_something_with_the_data(HostBuffer<float>& host)
//{
//	cout << "Do sth with the data ... " << endl;
//}
//
//void generate_heat(float *ptr, const Extent2& ext, const int num_elems, const int seed)
//{
//	assert(ptr);
//
//	default_random_engine generator(seed);
//
//	uniform_int_distribution<int> distribution_x(margin, ext.get_width() - margin);
//	uniform_int_distribution<int> distribution_y(margin, ext.get_height() - margin);
//	uniform_real_distribution<float> distribution_t(min_temp, max_temp);
//
//	auto dice_x = bind(distribution_x, generator);
//	auto dice_y = bind(distribution_y, generator);
//	auto dice_t = bind(distribution_t, generator);
//
//	for (int i = 0; i < num_elems; i++)
//	{
//		ptr[ext.index(dice_x(), dice_y())] = dice_t();
//	}
//}
//
//void generate_heat(HostBuffer<float>& host, const int num_sources, const int seed)
//{
//	fill(host.begin(), host.end(), 0.0f);				// set all to zero
//	generate_heat(host.get_ptr(), host.get_extent(), num_sources, seed);
//}
//
//void generate_heat(std::shared_ptr<HostBuffer<float>> buf, const int num_elems, const int seed)
//{
//	generate_heat(*buf.get(), num_elems, seed);
//}
//
//UnpinnedBuffer<float>* create_heat_host(const Extent2& ext, const int num_points, const int seed)
//{
//	UnpinnedBuffer<float>* host = new UnpinnedBuffer<float>(ext);
//	host->alloc();
//	fill(host->begin(), host->end(), 0.0f);				// set all to zero
//	generate_heat(*host, num_points, seed);				// generate random heat points
//	return host;
//}
//

#ifdef COMPILE_FOR_CUDA

//DeviceBuffer<float>* create_heat(const Extent2& ext, const int num_points, const int seed)
//{
//	DeviceBuffer<float>* device = new DeviceBuffer<float>(ext);
//	PinnedBuffer<float> host(ext);
//	host.alloc();
//	generate_heat(host, num_points, seed);				// generate random heat points
//	// copy to device
//	device->alloc();
//	device->copy_from(host);
//	host.free();
//	return device;
//}

/* imported with GIMP.
 
   GIMP RGB C-Source image dump (waermebild_2.c) 

   */

static const struct
{
	unsigned int 	 width;
	unsigned int 	 height;
	unsigned int 	 bytes_per_pixel; /* 2:RGB16, 3:RGB, 4:RGBA */
	unsigned char	 pixel_data[1048 * 1 * 4 + 1];
} gimp_image = {
	1048, 1, 4,
	"\2\0\16\377\3\0\23\377\3\1\27\377\1\0\37\377\0\0$\377\1\0(\377\0\0,\377\0"
	"\1""1\377\0\1""1\377\0\1""1\377\0\2""3\377\0\2""3\377\0\2""3\377\0\2""2\377"
	"\1\3""3\377\2\4""4\377\2\4""4\377\3\5""6\377\2\3""9\377\1\4""9\377\2\5""8"
	"\377\0\6:\377\0\6<\377\1\6=\377\1\6>\377\1\6@\377\1\6@\377\0\6@\377\1\7C"
	"\377\0\10C\377\0\11D\377\0\10C\377\0\7E\377\0\10F\377\0\11G\377\0\10I\377"
	"\0\11J\377\1\12K\377\1\14L\377\2\13L\377\1\14L\377\1\14L\377\1\14N\377\1"
	"\13R\377\1\13R\377\0\15S\377\0\17T\377\0\17T\377\0\16U\377\1\17V\377\1\17"
	"V\377\1\17V\377\0\21W\377\0\21Y\377\0\20[\377\0\20[\377\0\22^\377\1\23_\377"
	"\1\23_\377\1\22`\377\0\23`\377\1\24a\377\2\23c\377\2\23e\377\2\24f\377\0"
	"\25f\377\0\25f\377\0\25h\377\0\25h\377\0\24j\377\0\26k\377\0\26k\377\0\26"
	"l\377\0\26l\377\1\27m\377\1\27m\377\0\27q\377\0\30r\377\0\31s\377\0\31u\377"
	"\0\31u\377\0\31u\377\0\31u\377\0\31u\377\0\31v\377\1\32w\377\2\32z\377\0"
	"\34z\377\0\33|\377\0\34\177\377\0\34\177\377\0\34\177\377\0\34\177\377\0"
	"\34\200\377\1\35\201\377\0\35\201\377\0\35\203\377\1\36\206\377\0\40\207"
	"\377\0\40\205\377\0!\205\377\0!\210\377\0!\212\377\0!\214\377\1\"\215\377"
	"\1\"\215\377\1\"\215\377\0\"\215\377\0\"\216\377\1#\217\377\1#\217\377\3"
	"#\220\377\2$\222\377\0$\222\377\0$\224\377\0$\224\377\0$\226\377\0%\230\377"
	"\1&\231\377\1&\231\377\1&\231\377\1&\233\377\0&\235\377\0)\235\377\0)\237"
	"\377\0(\241\377\0(\241\377\0(\241\377\1)\242\377\1)\243\377\0)\241\377\1"
	")\242\377\2*\244\377\2*\244\377\2+\247\377\0,\251\377\2*\255\377\1*\252\377"
	"\0+\253\377\0-\254\377\1.\255\377\2-\257\377\2.\263\377\2-\260\377\1-\260"
	"\377\2.\261\377\1""0\262\377\0""1\262\377\0""1\264\377\1/\266\377\2""0\271"
	"\377\1""1\271\377\2""0\271\377\1/\271\377\1/\271\377\0""1\272\377\0""3\273"
	"\377\0""4\274\377\1""5\275\377\1""5\277\377\2""5\302\377\2""5\302\377\1""6"
	"\304\377\0""4\305\377\0""4\305\377\1""5\307\377\1""5\307\377\1""5\306\377"
	"\1""5\311\377\0""6\312\377\0""6\312\377\0""8\313\377\0""8\315\377\0""7\317"
	"\377\0""7\317\377\1""8\320\377\0""9\320\377\1:\322\377\1:\321\377\2;\323"
	"\377\2;\323\377\0;\325\377\0;\327\377\0;\327\377\0;\327\377\0<\332\377\1"
	"=\333\377\2>\334\377\2>\334\377\0?\334\377\0>\335\377\0>\337\377\0>\337\377"
	"\0>\341\377\0?\344\377\0?\344\377\1@\347\377\2A\346\377\3B\347\377\3D\352"
	"\377\3D\352\377\2A\350\377\2@\351\377\2B\352\377\0C\354\377\0C\354\377\0"
	"D\355\377\0D\357\377\0D\361\377\1E\362\377\0D\361\377\1E\362\377\1E\362\377"
	"\0E\363\377\0E\363\377\0F\366\377\0G\371\377\0G\371\377\0G\371\377\1H\372"
	"\377\1H\374\377\1G\376\377\0H\374\377\0I\377\377\0J\373\377\0J\371\377\0"
	"J\371\377\0J\371\377\0J\367\377\0J\367\377\0J\367\377\0L\367\377\0L\367\377"
	"\0L\370\377\0L\370\377\0L\367\377\0M\365\377\0O\364\377\0O\364\377\0O\362"
	"\377\0O\362\377\0O\362\377\0O\362\377\1P\362\377\1Q\360\377\0S\357\377\0"
	"S\357\377\0S\357\377\0S\357\377\0S\357\377\0S\357\377\0S\357\377\0S\357\377"
	"\0S\355\377\0U\354\377\0V\353\377\0V\353\377\0V\353\377\1W\352\377\2X\351"
	"\377\2X\351\377\1W\350\377\1W\350\377\0X\346\377\0X\346\377\0Z\346\377\0"
	"Z\344\377\0\\\345\377\0\\\343\377\0\\\341\377\1`\342\377\1`\342\377\1`\340"
	"\377\0a\334\377\0b\335\377\0b\335\377\0c\335\377\0c\333\377\0e\333\377\0"
	"g\332\377\0h\327\377\0g\326\377\0h\327\377\1j\327\377\0k\325\377\2o\326\377"
	"\2o\330\377\1n\323\377\1n\323\377\2n\321\377\3o\321\377\3q\320\377\1r\316"
	"\377\0r\313\377\0s\314\377\1u\312\377\0u\314\377\0v\315\377\0w\313\377\0"
	"w\307\377\1y\305\377\0z\303\377\1{\304\377\1{\304\377\1|\302\377\1|\277\377"
	"\2~\274\377\1\177\272\377\0\201\273\377\1\202\271\377\0\202\264\377\0\202"
	"\263\377\0\203\261\377\0\203\257\377\0\203\257\377\1\206\257\377\1\207\255"
	"\377\1\207\254\377\1\210\246\377\0\212\244\377\1\214\243\377\0\215\241\377"
	"\0\215\241\377\0\215\236\377\0\216\234\377\0\216\232\377\0\217\227\377\0"
	"\221\226\377\0\221\226\377\1\222\225\377\1\223\222\377\1\224\216\377\0\226"
	"\215\377\0\226\213\377\0\226\212\377\0\230\211\377\1\232\206\377\1\232\206"
	"\377\1\232\206\377\0\234\201\377\0\235\200\377\0\235\200\377\0\234}\377\0"
	"\236}\377\0\237y\377\0\237w\377\1\241u\377\1\243r\377\1\243r\377\1\245r\377"
	"\1\245p\377\2\247k\377\1\246j\377\0\250j\377\0\251h\377\0\251f\377\0\251"
	"d\377\0\253a\377\0\255^\377\0\255^\377\0\255]\377\0\256Y\377\1\257X\377\0"
	"\260V\377\0\261V\377\0\264S\377\0\264Q\377\0\264P\377\0\264M\377\0\265L\377"
	"\0\265L\377\2\267L\377\1\271I\377\2\273D\377\1\273@\377\0\274>\377\0\274"
	">\377\0\274<\377\0\274<\377\0\275<\377\0\3009\377\0\3005\377\0\3014\377\0"
	"\3042\377\0\3050\377\0\3070\377\0\3070\377\0\307.\377\0\310*\377\0\310(\377"
	"\0\310(\377\0\310'\377\0\311#\377\1\312\"\377\1\313!\377\1\315\40\377\1\315"
	"\36\377\0\316\33\377\0\321\26\377\1\322\24\377\1\323\16\377\0\323\10\377"
	"\0\324\5\377\0\324\3\377\0\325\0\377\0\327\0\377\0\327\0\377\2\327\1\377"
	"\1\330\1\377\0\332\0\377\0\334\0\377\0\334\0\377\1\335\1\377\1\335\1\377"
	"\2\336\2\377\1\337\2\377\1\342\2\377\1\342\2\377\1\342\2\377\1\342\2\377"
	"\1\342\2\377\1\343\3\377\0\345\2\377\0\347\1\377\0\347\1\377\0\347\3\377"
	"\0\347\3\377\1\350\2\377\3\353\3\377\3\355\2\377\3\355\0\377\2\353\3\377"
	"\2\354\1\377\1\356\0\377\1\360\0\377\0\361\0\377\0\362\0\377\0\363\1\377"
	"\0\364\0\377\1\365\0\377\0\365\0\377\0\366\0\377\1\367\0\377\1\367\0\377"
	"\1\367\0\377\0\370\1\377\0\370\1\377\0\374\3\377\3\374\2\377\6\374\1\377"
	"\15\374\1\377\25\373\2\377\32\373\1\377\40\373\1\377(\372\1\377/\372\2\377"
	"6\372\0\377;\374\1\377@\375\1\377F\376\0\377O\375\0\377X\373\0\377`\375\0"
	"\377g\376\0\377l\375\0\377o\374\0\377p\373\0\377v\372\0\377x\373\0\377x\373"
	"\0\377y\374\0\377z\373\0\377}\373\1\377}\373\1\377~\373\1\377\203\374\1\377"
	"\205\374\0\377\205\374\0\377\211\374\1\377\211\374\1\377\214\375\0\377\214"
	"\375\0\377\216\375\0\377\222\375\1\377\223\374\1\377\225\374\0\377\227\374"
	"\0\377\227\374\0\377\231\374\1\377\234\375\0\377\237\373\0\377\241\374\1"
	"\377\242\373\1\377\242\373\1\377\242\373\0\377\245\374\0\377\247\376\2\377"
	"\251\376\2\377\254\377\3\377\253\374\1\377\255\374\2\377\261\374\1\377\264"
	"\375\0\377\264\374\4\377\265\374\2\377\267\374\1\377\272\375\0\377\273\374"
	"\0\377\275\373\0\377\276\373\0\377\300\373\0\377\303\374\0\377\306\375\2"
	"\377\306\375\1\377\310\375\1\377\311\376\2\377\312\375\2\377\315\373\2\377"
	"\316\374\3\377\321\373\3\377\322\375\0\377\322\375\0\377\323\374\0\377\327"
	"\374\1\377\331\374\0\377\334\374\1\377\335\374\1\377\336\375\2\377\337\374"
	"\2\377\341\374\1\377\341\374\0\377\344\375\1\377\347\376\2\377\350\375\2"
	"\377\351\374\2\377\354\375\1\377\354\375\1\377\360\375\0\377\362\375\1\377"
	"\365\374\0\377\366\373\0\377\370\372\0\377\372\373\0\377\372\373\0\377\373"
	"\372\0\377\373\372\0\377\373\372\0\377\372\371\0\377\374\370\1\377\375\367"
	"\1\377\377\370\2\377\377\364\2\377\375\364\3\377\374\363\2\377\374\363\4"
	"\377\375\362\2\377\375\360\1\377\374\361\1\377\373\360\2\377\373\356\1\377"
	"\373\356\1\377\374\354\1\377\373\353\0\377\373\351\0\377\372\350\0\377\374"
	"\347\0\377\375\350\1\377\375\347\0\377\374\347\0\377\374\347\2\377\373\346"
	"\1\377\374\345\3\377\374\343\2\377\374\343\3\377\372\341\1\377\373\337\0"
	"\377\374\336\0\377\376\336\0\377\375\335\0\377\375\335\0\377\375\335\0\377"
	"\375\335\0\377\375\333\0\377\374\331\1\377\373\330\0\377\372\327\1\377\373"
	"\326\1\377\374\324\0\377\374\322\1\377\374\322\1\377\374\322\2\377\374\322"
	"\2\377\373\321\1\377\374\317\0\377\374\317\0\377\374\316\0\377\374\316\0"
	"\377\374\316\0\377\374\316\0\377\374\315\1\377\373\313\0\377\372\311\2\377"
	"\373\307\1\377\373\305\0\377\374\304\0\377\374\303\0\377\375\303\0\377\374"
	"\303\0\377\374\302\0\377\374\301\1\377\374\301\1\377\374\301\1\377\373\300"
	"\0\377\373\276\1\377\373\276\1\377\375\276\1\377\374\275\0\377\373\273\1"
	"\377\373\272\0\377\374\273\1\377\375\271\0\377\375\270\1\377\374\267\0\377"
	"\375\267\0\377\376\265\0\377\376\263\0\377\375\262\0\377\375\262\0\377\374"
	"\263\0\377\374\261\0\377\374\261\0\377\374\260\4\377\374\256\3\377\375\255"
	"\2\377\374\254\1\377\374\254\1\377\374\252\0\377\376\251\0\377\376\251\0"
	"\377\375\250\0\377\375\246\1\377\374\245\0\377\374\245\0\377\374\243\1\377"
	"\373\242\0\377\373\242\0\377\373\242\0\377\373\242\0\377\374\240\1\377\375"
	"\237\1\377\374\236\0\377\374\236\0\377\375\234\0\377\376\233\0\377\375\232"
	"\0\377\374\231\0\377\374\227\1\377\376\226\1\377\376\226\1\377\375\225\0"
	"\377\375\225\2\377\375\225\2\377\374\224\0\377\373\222\2\377\373\221\1\377"
	"\373\221\1\377\375\220\1\377\375\216\0\377\374\215\0\377\373\214\0\377\373"
	"\213\1\377\373\213\1\377\373\211\2\377\375\207\3\377\375\207\3\377\374\206"
	"\2\377\374\206\0\377\374\206\2\377\374\206\2\377\372\203\3\377\373\202\0"
	"\377\373\202\0\377\375\202\1\377\375\202\1\377\374\200\2\377\374\177\1\377"
	"\374|\1\377\377{\4\377\375}\2\377\373}\2\377\374|\1\377\374z\0\377\373y\1"
	"\377\374w\0\377\374u\0\377\374u\0\377\375t\0\377\374s\0\377\373r\0\377\371"
	"r\0\377\372p\1\377\374p\1\377\376p\2\377\375o\1\377\374n\0\377\375l\1\377"
	"\375j\2\377\374i\1\377\374i\1\377\374i\1\377\374i\1\377\373f\0\377\374d\0"
	"\377\374b\0\377\373b\2\377\373`\3\377\374]\1\377\374[\1\377\375Y\0\377\373"
	"W\0\377\374V\0\377\375T\1\377\374Q\1\377\374Q\1\377\374O\2\377\375M\2\377"
	"\375K\1\377\374J\0\377\374J\0\377\375H\1\377\375F\2\377\373D\2\377\373B\2"
	"\377\374@\0\377\377?\0\377\376>\0\377\375:\0\377\3749\1\377\3738\2\377\373"
	"6\1\377\3755\1\377\3753\1\377\3751\0\377\373,\0\377\372)\2\377\373%\1\377"
	"\373%\1\377\375%\0\377\375#\0\377\374\40\0\377\374\32\1\377\375\30\1\377"
	"\375\27\0\377\375\27\0\377\374\26\0\377\373\22\1\377\373\17\1\377\372\14"
	"\0\377\374\12\0\377\372\7\1\377\374\5\0\377\374\5\0\377\373\2\0\377\374\0"
	"\1\377\375\0\3\377\375\0\3\377\376\0\5\377\372\1\7\377\373\0\7\377\374\1"
	"\12\377\374\0\13\377\374\0\15\377\374\0\21\377\373\0\23\377\374\1\24\377"
	"\374\0\25\377\374\0\27\377\374\0\31\377\374\0\31\377\375\0\34\377\375\0\34"
	"\377\375\0\35\377\375\0\35\377\373\0\37\377\373\0!\377\373\0#\377\372\0#"
	"\377\372\0&\377\373\0+\377\373\0-\377\373\0-\377\373\0-\377\373\0-\377\374"
	"\0/\377\374\0""1\377\374\0""3\377\375\0""7\377\375\0""9\377\375\0""9\377"
	"\375\1>\377\374\0=\377\375\0@\377\375\0@\377\375\0A\377\375\0A\377\373\0"
	"C\377\373\0C\377\373\0G\377\373\0G\377\373\1K\377\373\1K\377\373\0M\377\373"
	"\0M\377\374\1P\377\374\1Q\377\374\0S\377\374\0S\377\374\0S\377\375\1V\377"
	"\375\0Z\377\375\0[\377\374\2\\\377\373\1[\377\375\0]\377\373\0a\377\373\0"
	"b\377\373\0a\377\374\0c\377\374\0e\377\374\0g\377\374\0c\377\373\0g\377\373"
	"\0i\377\374\1k\377\374\0m\377\374\0o\377\374\0q\377\375\1r\377\375\0t\377"
	"\375\0t\377\374\1t\377\374\1t\377\374\1u\377\374\0w\377\376\0|\377\376\0"
	"}\377\375\0}\377\375\0\177\377\375\0\177\377\373\0\203\377\373\0\205\377"
	"\374\0\207\377\374\0\207\377\374\0\207\377\374\0\211\377\373\0\213\377\374"
	"\1\216\377\375\2\217\377\374\1\216\377\374\1\216\377\374\1\217\377\374\0"
	"\223\377\374\0\225\377\374\0\225\377\375\1\226\377\375\0\227\377\375\0\231"
	"\377\375\0\233\377\373\0\233\377\373\0\235\377\373\1\240\377\374\1\240\377"
	"\374\0\243\377\373\0\245\377\373\0\247\377\373\0\247\377\373\0\247\377\374"
	"\1\251\377\374\1\251\377\374\0\255\377\374\0\255\377\374\0\257\377\374\0"
	"\257\377\375\0\262\377\374\1\262\377\375\2\264\377\374\0\265\377\375\1\272"
	"\377\375\1\272\377\375\1\272\377\375\0\273\377\375\0\273\377\375\0\275\377"
	"\376\0\300\377\376\0\302\377\374\1\302\377\374\1\303\377\374\0\305\377\374"
	"\0\307\377\374\0\311\377\373\0\313\377\374\1\314\377\374\1\314\377\374\1"
	"\314\377\374\0\317\377\374\0\323\377\374\0\323\377\375\0\324\377\373\1\324"
	"\377\373\1\325\377\372\2\325\377\373\0\331\377\373\0\333\377\373\0\334\377"
	"\373\0\333\377\373\0\333\377\374\0\335\377\374\0\341\377\374\0\341\377\373"
	"\0\343\377\374\1\346\377\374\0\347\377\374\0\347\377\374\0\351\377\374\0"
	"\351\377\374\0\353\377\374\0\355\377\373\0\355\377\373\0\360\377\373\0\362"
	"\377\374\0\363\377\372\1\363\377\372\0\367\377\375\0\371\377\376\1\372\377"
	"\375\0\370\377\373\1\370\377\374\4\373\377\372\4\375\377\372\6\376\377\374"
	"\10\376\377\375\11\376\377\375\12\374\377\375\14\373\377\373\16\372\377\373"
	"\22\372\377\375\25\375\377\375\25\377\377\375\25\375\377\375\27\375\377\374"
	"\31\374\377\374\33\373\377\374\36\373\377\376#\375\377\377$\374\377\375$"
	"\373\377\373&\374\377\373)\376\377\373)\376\377\373+\373\377\374,\374\377"
	"\375/\374\377\3752\376\377\3735\374\377\3737\373\377\3739\372\377\3739\372"
	"\377\376;\373\377\373>\374\377\376?\376\377\373A\374\377\375C\376\377\374"
	"D\374\377\375C\374\377\375G\374\377\374K\375\377\373O\375\377\374P\374\377"
	"\375P\372\377\375S\374\377\374U\373\377\374W\373\377\374Z\375\377\374^\375"
	"\377\375_\374\377\373a\375\377\375c\377\377\375d\374\377\373g\373\377\374"
	"h\372\377\376m\372\377\374o\374\377\374r\375\377\374s\376\377\373w\376\377"
	"\373y\375\377\371z\373\377\372}\375\377\373~\376\377\374\200\374\377\372"
	"\204\374\377\372\207\376\377\374\211\377\377\372\214\375\377\372\216\376"
	"\377\372\216\376\377\374\216\376\377\375\222\374\377\373\226\374\377\374"
	"\227\375\377\375\231\374\377\373\233\374\377\372\237\374\377\373\242\374"
	"\377\372\244\373\377\372\246\374\377\374\250\375\377\373\252\371\377\374"
	"\256\372\377\375\261\373\377\374\263\374\377\374\264\375\377\374\266\374"
	"\377\373\270\375\377\375\272\377\377\376\275\377\377\374\300\374\377\374"
	"\302\374\377\373\304\373\377\374\307\373\377\374\312\373\377\374\312\373"
	"\377\373\315\374\377\372\317\375\377\373\322\376\377\372\323\377\377\371"
	"\324\375\377\374\326\373\377\374\331\372\377\374\335\374\377\373\341\376"
	"\377\374\342\373\377\373\343\373\377\375\345\373\377\376\351\374\377\375"
	"\352\376\377\377\377\377\377\354\356\355\377",
};

ManagedBuffer<uchar4>* get_color_buffer()
{
	Extent2 ext(gimp_image.width, gimp_image.height);
	ManagedBuffer<uchar4>* buf = new ManagedBuffer<uchar4>(ext);
	buf->alloc();
	uchar4* ptr = buf->get_ptr();
	uchar4* src = (uchar4*) &gimp_image.pixel_data;
	for (int i = 0; i < (int) gimp_image.width; i++)
	{
		ptr[i] = src[i];
	}
	return buf;
}

#endif

